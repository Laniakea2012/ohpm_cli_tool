"use strict";var e=this&&this.__awaiter||function(e,i,t,r){return new(t||(t=Promise))((function(n,o){function a(e){try{p(r.next(e))}catch(e){o(e)}}function s(e){try{p(r.throw(e))}catch(e){o(e)}}function p(e){var i;e.done?n(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(a,s)}p((r=r.apply(e,i||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SourceCodeDepBuilderImpl=void 0;const t=require("../../util"),r=i(require("path")),n=require("../../../../common/Constants"),o=require("../../../../common/message"),a=require("../../../../util/OsUtil"),s=require("../../../../config"),p=require("../../util/getFilePathHash");exports.SourceCodeDepBuilderImpl=class{build(i){return e(this,void 0,void 0,(function*(){if(a.OsUtil.isWindows&&r.default.parse(i.pinnedSpec).root!==r.default.parse(s.config.getProjectRoot()).root)throw new Error((0,o.format)(o.Messages.DepBuilder.CrossDriverError,{pkg:`${i.name}@${i.fetchSpec}`}));if(i.isNativeSoType&&"InterfaceHar"===i.packageType)throw new Error((0,o.format)(o.Messages.DepBuilder.InvalidInterfaceHar,{pkg:`${i.name}@${i.version}`}));let e,c;if(i.isLink)e=i.pinnedSpec,c=e;else{const o=yield(0,p.getFilePathHash)(i.pinnedSpec);e=yield(0,t.getPkgStoreDirName)(i.name,i.pinnedSpec,o),c=r.default.join(n.Constants.MyModules,i.name)}return{name:i.name,version:i.version,actualName:i.actualName,fetchSpec:i.fetchSpec,isNativeSoType:i.isNativeSoType,registryType:i.registryType,resolved:i.resolved,saveSpec:i.saveSpec,pinnedSpec:i.pinnedSpec,packageType:i.packageType,ohpaType:i.ohpaType,isShared:i.isShared,isLink:i.isLink,saveRootDir:e,pkgStoreDir:c,isRoot:i.isRoot,dependencies:i.dependencies,dynamicDependencies:i.dynamicDependencies}}))}};