"use strict";var e=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.convertTraceToEvent=void 0;const n=require("../model/EventBean"),s=t(require("../../../log")),r=require("../../../common/message"),i=require("../types");exports.convertTraceToEvent=function(t,o=!1){return e(this,void 0,void 0,(function*(){if(s.default.debug("",`start convert trace data to event, isNextIDE: ${o}`),!t)throw new Error(r.Messages.TraceWriter.TraceEmptyError);let e;return e=o?function(e){const t=new n.EventBean;t.type=i.Audit.EVENT_TYPE,t.event=e.data?e.data[i.Audit.FIELD_EVENT_CMD_NAME]:"",t.eventtime=String(e.timestamp);const s=new Map;return s.set("data",JSON.stringify(e.data,null,2)),s.set("uid",e.uid),s.set("trace_uuid",e.traceUuid),s.set("trace_sid",e.traceSid),s.set("version",e.version),s.set("build_time",""),s.set("os_arch",i.Audit.NEXT_OS_ARCH),s.set("timestamp",e.timestamp.toString()),s.set("trace_os_name",i.Audit.NEXT_TRACE_OS_NAME),s.set("trace_os_version",e.traceOsVersion),s.set("eventVersion",i.Audit.UNKNOWN),s.set("eventID",i.Audit.UNKNOWN),s.set("sessionid",i.Audit.UNKNOWN),t.properties=s,t}(t):function(e){const t=new n.EventBean;t.type=i.Audit.EVENT_TYPE,t.event=e.data?e.data[i.Audit.FIELD_EVENT_CMD_NAME]:"",t.eventtime=String(e.timestamp);const s=function(e){const t=new Map,n=Object.keys(e);for(const s of n)t.set(s,e[s]);return t}(e.data);return s.set("uid",e.uid),s.set("trace_uuid",e.traceUuid),s.set("trace_sid",e.traceSid),s.set("version",e.version),s.set("build_time",""),s.set("os_arch",e.osArch),s.set("timestamp",e.timestamp.toString()),s.set("trace_os_name",e.traceOsName),s.set("trace_os_version",e.traceOsVersion),s.set("eventVersion",e.eventVersion),s.set("eventID",e.eventID),s.set("sessionid",e.sessionid),t.properties=s,t}(t),s.default.debug("","convert trace data to event succeed"),e}))};