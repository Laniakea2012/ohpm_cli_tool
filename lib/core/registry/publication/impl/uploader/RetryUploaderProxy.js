"use strict";var e=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}u((o=o.apply(e,t||[])).next())}))},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RetryUploaderProxy=void 0;const r=t(require("../../../../../log")),o=require("../../../../../common/message");class n{constructor(e){this.uploader=e}uploadPackage(t,a,i){return e(this,void 0,void 0,(function*(){let e=0;for(;e<n.MAX_RETRY_TIMES;)try{return yield this.uploader.uploadPackage(t,a,i)}catch(t){if(t.code!==n.RETRY_CODE)throw t;r.default.warn("",`Package "${a.name}" is locked, wait ${n.RETRY_INTERVAL/1e3} seconds to retry publish`),yield new Promise((e=>setTimeout(e,n.RETRY_INTERVAL))),e++,r.default.info("",`Retry publish Package "${a.name}" the ${e} time`)}throw new Error((0,o.format)(o.Messages.Publish.PkgIsLocked,{pkg:a.name,maxRetryTimes:n.MAX_RETRY_TIMES.toString()}))}))}}exports.RetryUploaderProxy=n,n.RETRY_CODE=598,n.MAX_RETRY_TIMES=3,n.RETRY_INTERVAL=3e4;